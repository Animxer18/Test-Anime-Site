<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Anime Site - Video Player</title>
	<link rel="stylesheet" href="https://cdn.plyr.io/3.6.8/plyr.css" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
	<link rel="stylesheet" href="https://cdn.plyr.io/3.6.8/demo.css" />
	<link rel="stylesheet" href="styles.css" />
	<script src="https://cdn.plyr.io/3.6.8/plyr.js"></script>
  <script src="https://cdn.jsdelivr.net/hls.js/latest/hls.js"></script>
</head>

<body>
	<header>
		<div class="header-wrapper">
            <a href="index.html">
                <div class="logo">Anime Site</div>
            </a>
		</div>
	</header>
	<main>
    <section class="video-section" id="video-section">
      <div class="container">
        <h2>Video Section</h2>
        <video id="player2" playsinline controls>
        </video>
      </div>
    
      <script>
        // Get the selected episode URL from sessionStorage
        const selectedEpisodeUrl = sessionStorage.getItem('selectedEpisodeUrl');
      
        // Check if the URL is set
        if (selectedEpisodeUrl) {
          // Print the URL to the console for debugging
          console.log('Episode URL from sessionStorage:', selectedEpisodeUrl);
      
          const video = document.querySelector('#player2');
          const source = document.createElement('source');
          source.src = selectedEpisodeUrl;
          
          // Check if HLS is supported
          if (Hls.isSupported()) {
            source.type = 'application/x-mpegURL'; // Update the source type
            video.appendChild(source);
            video.load();
          
            // Initialize the HLS video player
            const hls = new Hls();
            hls.loadSource(selectedEpisodeUrl);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED,function() {
              video.play();
            });
          } else {
            // Fallback to progressive download
            source.type = 'video/mp4'; // Update the source type
            video.appendChild(source);
            video.load();
          }
          
          // Initialize the Plyr video player
          const player = new Plyr('#player2', {
            controls: [
              'play-large',
              'rewind',
              'play',
              'fast-forward',
              'progress',
              'current-time',
              'duration',
              'mute',
              'volume',
              'quality',
              'captions',
              'settings',
              'pip',
              'airplay',
              'fullscreen',
            ],
          });
        } else {
          // Redirect back to index.html if no episode URL is found
          window.location.href = 'index.html';
        }
      </script>
      
      
		</section>
	</main>

	<footer>
		<div class="footer-wrapper">
			<p>&copy; Anime Site 2023</p>
		</div>
	</footer>
</body>
</html>
